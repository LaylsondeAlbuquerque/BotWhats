<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Configura√ß√£o do Bot</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f0f2f5;
        }

        div {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 8px 0px 8px 0px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #075e54;
            text-align: center;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        textarea {
            width: 90%;
            height: 80px;
            margin-top: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background-color: #25d366;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #128c7e;
        }

        #status {
            text-align: center;
            margin-top: 10px;
            color: green;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <header>

        <h1>ü§ñ Configurar Bot WhatsApp</h1>

    </header>

    <main class="card">

        <div>

            <h2>Dias e horas de funcionamento</h2>

            <h3>Dias da semana</h3>

            <fieldset id="group-days" onchange="getSelectedDays()">

                <legend>Dias de Atendimento</legend>

                <label><input type="checkbox" name="dias" value="0"> Domingo</label>
                <label><input type="checkbox" name="dias" value="1"> Segunda</label>
                <label><input type="checkbox" name="dias" value="2"> Ter√ßa</label>
                <label><input type="checkbox" name="dias" value="3"> Quarta</label>
                <label><input type="checkbox" name="dias" value="4"> Quinta</label>
                <label><input type="checkbox" name="dias" value="5"> Sexta</label>
                <label><input type="checkbox" name="dias" value="6"> S√°bado</label>

            </fieldset>

            <h3>Hor√°rio de funcionamento</h3>

            <label>In√≠cio</label>
            <input type="time" id="inicio">

            <label>Fim</label>
            <input type="time" id="fim">

            <h3>Hor√°rio de almo√ßo</h3>

            <label>In√≠cio</label>
            <input type="time" id="almocoInicio">

            <label>Fim</label>
            <input type="time" id="almocoFim">

        </div>

        <div>

            <h2>Caso o cliente s√≥ envie um arquivo:</h2>

            <label>Mensagem de Sauda√ß√£o (Oi/Ol√°)</label>
            <textarea id="saudacao_arquivo"></textarea>

            <label>Menu de Op√ß√µes</label>
            <textarea id="menu_arquivo"></textarea>

            <h3>Respostas ao menu</h3>

            <label>Op√ß√£o um:</label>
            <textarea id="opUmArc"></textarea>

            <label>Op√ß√£o dois:</label>
            <textarea id="opDoisArc"></textarea>

        </div>

        <div>


            <h2>Caso o cliente envie uma mensagem:</h2>

            <label>Mensagem de Sauda√ß√£o (Oi/Ol√°):</label>
            <textarea id="saudacao"></textarea>

            <label>Menu de Op√ß√µes:</label>
            <textarea id="menu"></textarea>

            <h3>Respostas ao menu</h3>

            <label>Op√ß√£o um:</label>
            <textarea id="opUm"></textarea>

            <label>Op√ß√£o dois:</label>
            <textarea id="opDois"></textarea>

            <button onclick="salvar()">Salvar Altera√ß√µes</button>
            <p id="status"></p>

        </div>

    </main>

    <script>

        // Fun√ß√£o para criar array com os dias selecionados
        function getSelectedDays() {
            const checkboxes = document.querySelectorAll('input[name="dias"]:checked');
            const dias = Array.from(checkboxes).map(cb => cb.value);
            console.log("Dias atualizados:", dias);
            return dias;
        }

        // Carregar dados ao abrir a p√°gina
        fetch('/api/config')
            .then(res => res.json())
            .then(data => {
                // Preencher os textos normais
                document.getElementById('saudacao_arquivo').value = data.saudacao_arquivo;
                document.getElementById('menu_arquivo').value = data.menu_arquivo;
                document.getElementById('saudacao').value = data.saudacao;
                document.getElementById('menu').value = data.menu;
                // Preencher as respostas opcionais (usei || '' para evitar erro se estiver vazio)
                document.getElementById('opUmArc').value = data.opUmArc || '';
                document.getElementById('opDoisArc').value = data.opDoisArc || '';
                document.getElementById('opUm').value = data.opUm || '';
                document.getElementById('opDois').value = data.opDois || '';

                // Marcas as horas de funcionamento
                document.getElementById('inicio').value = data.horarioInicio || '';
                document.getElementById('fim').value = data.horarioFim || '';
                document.getElementById('almocoInicio').value = data.almocoInicio || '';
                document.getElementById('almocoFim').value = data.almocoFim || '';

                // Marcar os dias de atendimento
                if (data.diasFuncionamento) {
                    data.diasFuncionamento.forEach(dia => {
                        // Procura o checkbox com esse valor e marca ele
                        const checkbox = document.querySelector(`input[name="dias"][value="${dia}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            });

        // Enviar dados ao clicar em Salvar
        function salvar() {

            const diasSelecionados = getSelectedDays();

            const dados = {

                // textos normais
                saudacao_arquivo: document.getElementById('saudacao_arquivo').value,
                menu_arquivo: document.getElementById('menu_arquivo').value,
                saudacao: document.getElementById('saudacao').value,
                menu: document.getElementById('menu').value,
                // Respostas opcionais
                opUmArc: document.getElementById('opUmArc').value,
                opDoisArc: document.getElementById('opDoisArc').value,
                opUm: document.getElementById('opUm').value,
                opDois: document.getElementById('opDois').value,
                // Hor√°rios de funcionamento
                horarioInicio: document.getElementById('inicio').value,
                horarioFim: document.getElementById('fim').value,
                almocoInicio: document.getElementById('almocoInicio').value,
                almocoFim: document.getElementById('almocoFim').value,
                // Dias de funcionamento
                diasFuncionamento: diasSelecionados
                
            };

            fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            }).then(() => {
                const status = document.getElementById('status');
                status.innerText = "Salvo com sucesso!";
                setTimeout(() => status.innerText = "", 3000);
            });
        }
    </script>

</body>

</html>